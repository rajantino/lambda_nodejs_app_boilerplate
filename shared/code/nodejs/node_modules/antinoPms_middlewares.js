const jwtSecretKey = require('antinoPms_config').getJwtSecret();
const jwt = require('jsonwebtoken');

exports.verifyRole = async (bearerToken,role) => {

try{
    if(typeof bearerToken != 'string'){
        throw {message:"not a valid token", errorCode:401};
    }
    const token = bearerToken.split(' ')[1];
    if(!token || token == ""){
        throw {message:"not a valid token", errorCode:401};
    }

    let user = await jwt.verify(token, jwtSecretKey);
    if(user.role == role){
        return {isAuthorised:true, userId:user.id};
    }else{
        throw {message:"not authorised to access this resource", errorCode:403}
    }
    

}
catch(err){
    console.log(err);
    throw err;
}

   };
   
   